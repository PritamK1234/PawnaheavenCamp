
## âœ… FINAL REPLIT PROMPT â€” â€œSHARE QR & LINKâ€ TAB (REFERRAL EXTENSION)

> **IMPORTANT RULES (DO NOT BREAK):**
>
> * Do NOT modify existing referral logic, earnings logic, or withdrawal logic
> * Do NOT change database schema unless explicitly required
> * Backend + Frontend task (UI addition + API support)
> * Keep everything backward-compatible
> * Referral attribution must be 100% reliable
>
> ---
>
> ## ðŸ§  CONTEXT
>
> We already have a working **Referral & Earnings System** with:
>
> * Withdraw tab
> * Stats tab
> * OTP-based login
> * Referral code generation
>
> Now we want to add **ONE NEW TAB** on the **Check Earning page**:
>
> ðŸ‘‰ **â€œShare QR & Linkâ€**
>
> This tab is purely for **referral promotion & sharing**.
>
> ---
>
> ## ðŸŽ¯ OBJECTIVE
>
> For **each referral user**, automatically generate and expose:
>
> 1. **Your QR Code**
> 2. **Your Referral Link**
> 3. **Your Referral Code**
>
> These must be:
>
> * UNIQUE per referral user
> * Deterministic (always the same for the same referral code)
> * Secure and tamper-proof
>
> ---
>
> ## ðŸ”— REFERRAL ENTRY METHODS (ALL MUST WORK)
>
> A referral should be applied automatically when:
>
> 1. Customer **scans QR code**
> 2. Customer **opens referral link**
> 3. Customer **manually enters referral code**
>
> In all cases:
>
> * Customer is redirected to the main website
> * Referral code is automatically applied in the booking form
> * Referral code must persist until booking completion
>
> ---
>
> ## ðŸ’° COMMISSION & PAYMENT LOGIC (DO NOT CHANGE)
>
> Booking flow (already approved):
>
> * Customer pays **30% advance online**
> * Remaining **70% paid offline to owner**
>
> From **30% advance**:
>
> * **15% â†’ Customer discount**
> * **35% â†’ Referral user earning**
> * **50% â†’ Platform earnings**
>
> Your task is ONLY to ensure:
>
> * Referral code is correctly attached to the booking
> * Earnings calculation continues to work as-is
>
> ---
>
> ## ðŸ§© BACKEND REQUIREMENTS
>
> ### 1ï¸âƒ£ Referral Link Generation
>
> Referral link format:
>
> ```
> https://ourdomain.com/?ref=REFERRALCODE
> ```
>
> Rules:
>
> * Referral code must be UPPERCASE
> * Lookup must be case-insensitive
> * Invalid codes must be ignored silently
>
> ---
>
> ### 2ï¸âƒ£ QR Code Generation
>
> * QR code should encode the **referral link**
> * Generated dynamically using backend or frontend utility
> * Must be reproducible (no random regeneration per request)
>
> ---
>
> ### 3ï¸âƒ£ New API (Optional but Preferred)
>
> Add to referral dashboard response:
>
> ```
> {
>   referralCode,
>   referralLink,
>   referralQrCodeUrl
> }
> ```
>
> OR
>
> Provide a dedicated endpoint:
>
> ```
> GET /api/referrals/share
> ```
>
> (JWT protected)
>
> ---
>
> ## ðŸ–¥ï¸ FRONTEND REQUIREMENTS
>
> ### New Tab: **Share QR & Link**
>
> Layout sections (mobile-first):
>
> #### Section 1: Your QR Code
>
> * Large, scannable QR
> * Download / Share option
>
> #### Section 2: Your Referral Link
>
> * Clickable link
> * Copy-to-clipboard button
>
> #### Section 3: Your Referral Code
>
> * Bold display
> * Tap-to-copy
>
> ---
>
> ## ðŸ§  REFERRAL AUTO-APPLY LOGIC
>
> When customer lands on website with:
>
> * `?ref=CODE`
>
> Then:
>
> * Validate referral code
> * Store it in:
>
>   * localStorage OR
>   * sessionStorage
> * Auto-fill referral code in booking form
> * Lock referral code (user cannot change it)
>
> Referral code must persist:
>
> * Across page reloads
> * Until booking is completed or expired
>
> ---
>
> ## ðŸ” SECURITY & EDGE CASES
>
> * Blocked referral users:
>
>   * Cannot generate QR or link
> * Referral codes:
>
>   * Stored in UPPERCASE
>   * Queried case-insensitively
> * No earnings unless booking is confirmed
>
> ---
>
> ## â›” DO NOT DO
>
> âŒ Change existing referral tables
> âŒ Change commission percentages
> âŒ Add admin logic
> âŒ Add payout automation
>
> ---
>
> ## âœ… REQUIRED OUTPUT
>
> 1. API changes (if any)
> 2. Referral link + QR generation logic
> 3. Frontend tab implementation plan
> 4. Referral auto-apply flow explanation
>
> âš ï¸ Start with **design explanation first**
> âš ï¸ Do NOT write code until approved
>
> WAIT for my confirmation before implementation.